# 图片数据库模块迁移计划

## 1. 功能清单

### V1 现有功能
- PPT源管理（添加、删除、扫描）
- 图片库设置（路径设置、提取图片、重建数据库）
- 图片显示和管理
  - 分页加载
  - 缩略图显示
  - 右键菜单
  - 图片复制
- 标签管理
  - 标签过滤
  - 批量标签处理
  - 标签搜索
- 资源清理

### V2 新增功能
- AI服务集成
- 异步操作支持
- 改进的错误处理
- 更好的类型提示

## 2. 迁移步骤

### 第一阶段：基础结构迁移
1. 保留原有的 `ImageDBHandlers` 类
2. 创建新的 `ImageService` 和 `TagService` 接口
3. 将数据库操作迁移到 `DatabaseManager`

### 第二阶段：UI组件迁移
1. 将 UI 组件改为继承 `QWidget`
2. 实现信号和槽机制
3. 保留原有的布局和功能

### 第三阶段：功能迁移
1. 将文件操作迁移到服务层
2. 实现异步标签处理
3. 整合 AI 服务
4. 改进错误处理

### 第四阶段：清理和优化
1. 删除废弃代码
2. 添加类型提示
3. 改进文档
4. 添加测试

## 3. 文件结构

### V1 到 V2 的映射关系
```
src/ui/tabs/image_db/
├── handlers.py -> handlers_v2.py (保留原始功能，添加新接口)
├── ui.py -> ui_v2.py (保留原始布局，添加新组件)
├── image_item.py (保持不变)
└── __init__.py (更新导出)
```

## 4. 注意事项
1. 保持向后兼容
2. 渐进式迁移
3. 充分测试
4. 保留原有文档 